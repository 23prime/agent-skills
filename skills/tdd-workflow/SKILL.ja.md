---
name: tdd-workflow
description: テスト駆動開発（TDD）のワークフロー原則。RED-GREEN-REFACTOR サイクル。
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
translated_from: SKILL.md
---

# TDD Workflow

> テストを先に書き、コードは後から。

---

## 1. TDD のフローとサイクル

1. カバーしたいテストシナリオのリストを作成する
2. 🔴 [RED] 失敗するテストを書く: リストから 1 項目だけを選び、実行可能な具体的なテストにする
3. 🟢 [GREEN] 最小限のコードで通す: テスト（および既存の全テスト）が通るようにコードを変更する（発見した項目はリストに追加する）
4. 🔵 [REFACTOR] コード品質を改善する: 必要に応じてリファクタリングし、実装設計を改善する
5. リストが空になるまで #2 に戻る

---

## 2. TDD の三原則

1. プロダクションコードは、失敗するテストを通すためにのみ書く
2. 失敗を示すのに十分なテストだけを書く
3. テストを通すのに十分なコードだけを書く

---

## 3. RED フェーズの原則

### 何を書くか

| 焦点 | 例 |
| ------- | --------- |
| 振る舞い | "should add two numbers" |
| エッジケース | "should handle empty input" |
| エラー状態 | "should throw for invalid data" |

### RED フェーズのルール

- テストはまず失敗しなければならない
- テスト名は期待する振る舞いを記述する
- 1 テストにつき 1 アサーション（理想）

---

## 4. GREEN フェーズの原則

### 最小限のコード

| 原則 | 意味 |
| ----------- | --------- |
| **YAGNI** | それは必要にならない |
| **最もシンプルなもの** | 通すための最小限を書く |
| **最適化しない** | まず動かす |

### GREEN フェーズのルール

- 不要なコードを書かない
- まだ最適化しない
- テストを通す、それだけ

---

## 5. REFACTOR フェーズの原則

### 改善対象

| 領域 | アクション |
| ------ | -------- |
| 重複 | 共通コードの抽出 |
| 命名 | 意図を明確にする |
| 構造 | 構成の改善 |
| 複雑さ | ロジックの簡素化 |

### REFACTOR のルール

- すべてのテストがグリーンのままであること
- 小さな段階的変更
- リファクタリングごとにコミットする

---

## 6. AAA パターン

すべてのテストは以下に従う:

| ステップ | 目的 |
| ------ | --------- |
| **Arrange** | テストデータのセットアップ |
| **Act** | テスト対象コードの実行 |
| **Assert** | 期待結果の検証 |

---

## 7. TDD を使う場面

| シナリオ | TDD の価値 |
| ---------- | ----------- |
| 新機能 | 高い |
| バグ修正 | 高い（先にテストを書く） |
| 複雑なロジック | 高い |
| 探索的開発 | 低い（スパイク後に TDD） |
| UI レイアウト | 低い |

---

## 8. テストの優先順位

| 優先度 | テスト種別 |
| ---------- | ----------- |
| 1 | ハッピーパス |
| 2 | エラーケース |
| 3 | エッジケース |
| 4 | パフォーマンス |

---

## 9. アンチパターン

| ❌ やってはいけないこと | ✅ やるべきこと |
| ---------- | ------- |
| RED フェーズを飛ばす | まずテストが失敗するのを確認する |
| テストを後から書く | テストを先に書く |
| 初期段階で過剰設計する | シンプルに保つ |
| 複数アサーション | 1 テストに 1 つの振る舞い |
| 実装をテストする | 振る舞いをテストする |

---

## 10. AI 活用型 TDD

### マルチエージェントパターン

| エージェント | 役割 |
| ------- | ------ |
| Agent A | 失敗するテストを書く (RED) |
| Agent B | テストを通す実装 (GREEN) |
| Agent C | 最適化 (REFACTOR) |

---

> **忘れないこと:** テストは仕様である。テストを書けないなら、要件を理解していない。
